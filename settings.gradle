rootProject.name = 'gradle-bootstrap-version'

static def isSnapshot(String version) {
    version.contains("SNAPSHOT")
}

def findVersion() {
    String version = findVersionLineInBuildFile()
    version.find(~"'.*'")
            .replaceAll("'", "")
}

private String findVersionLineInBuildFile() {
    def writer = new StringWriter()
    writeVersionFromBuildFile(writer)
    writer.buffer.toString()
}

private Writer writeVersionFromBuildFile(StringWriter writer) {
    rootProject.buildFile
            .filterLine { it.startsWith("version") }
            .writeTo(writer)
}

def modifyVersion(String oldVersion, String newVersion) {
    rootProject.buildFile
            .text
            .replaceAll(oldVersion, newVersion)
            .with {
                rootProject.buildFile.write(it)
            }
}

def removeSnapshot() {
    findVersion().with { String oldVersion ->
        println "Version is: $oldVersion\nisSnapshot:${isSnapshot(oldVersion)}"
        if(isSnapshot(oldVersion)) {
            println "removing snapshot"
            def cleanVersion = oldVersion.substring(0, oldVersion.findIndexOf {it == "-" || it == " "})
            println "clean version $cleanVersion"
            modifyVersion(oldVersion, cleanVersion)
        } else {
            return null
        }
    }
}



